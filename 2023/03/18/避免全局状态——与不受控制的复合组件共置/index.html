<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="å‡ºäºæ‰€æœ‰æœ€å¥½çš„æ„å›¾ï¼Œä»£ç åº“é€šå¸¸æœ€ç»ˆä¼šå˜æˆä¸€ä¸ªç”±ç»„ä»¶ã€æŠ½è±¡å’Œå…¨å±€çŠ¶æ€ï¼ˆç”±ç¬¬ä¸‰æ–¹åº“ç®¡ç†ï¼‰ç»„æˆçš„é”™ç»¼å¤æ‚çš„ç½‘ç»œï¼Œä½¿æœ€å°çš„æ›´æ”¹æˆä¸ºæ´»ç”Ÿç”Ÿçš„å™©æ¢¦ï¼Œè€Œç»´æŠ¤åˆ™æˆä¸ºä¸€ç§å¹³è¡¡è¡Œä¸ºã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°äººä»¬è°ˆè®ºé¿å…æŠ½è±¡ï¼Œä½†æ˜¯å¦‚ä½•å‘¢ï¼Ÿæœ‰æ—¶æˆ‘ä»¬éœ€è¦æå‡è¯¥çŠ¶æ€ä»¥å…±äº«å®ƒï¼Œæˆ–è€…å°†è¯¥ç»„ä»¶æ”¾åœ¨æ ‘ä¸­æ›´é«˜çš„ä½ç½®ä»¥ä¾¿åº”ç”¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†å¯ä»¥æ§åˆ¶å®ƒâ€¦â€¦å¯¹å—ï¼Ÿâ€¦â€¦ğŸ¤” è¿™äº›å¹´æ¥ï¼Œæˆ‘å¯¹æ‰˜ç®¡ä»¥åŠå¦‚ä½•æœ‰æ•ˆåœ°å°†è¿™ä¸€åŸåˆ™åº”ç”¨åˆ°æˆ‘æ„å»ºçš„ç»„ä»¶è¿›">
<meta property="og:type" content="article">
<meta property="og:title" content="é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®">
<meta property="og:url" content="https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/index.html">
<meta property="og:site_name" content="Teyvat">
<meta property="og:description" content="å‡ºäºæ‰€æœ‰æœ€å¥½çš„æ„å›¾ï¼Œä»£ç åº“é€šå¸¸æœ€ç»ˆä¼šå˜æˆä¸€ä¸ªç”±ç»„ä»¶ã€æŠ½è±¡å’Œå…¨å±€çŠ¶æ€ï¼ˆç”±ç¬¬ä¸‰æ–¹åº“ç®¡ç†ï¼‰ç»„æˆçš„é”™ç»¼å¤æ‚çš„ç½‘ç»œï¼Œä½¿æœ€å°çš„æ›´æ”¹æˆä¸ºæ´»ç”Ÿç”Ÿçš„å™©æ¢¦ï¼Œè€Œç»´æŠ¤åˆ™æˆä¸ºä¸€ç§å¹³è¡¡è¡Œä¸ºã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°äººä»¬è°ˆè®ºé¿å…æŠ½è±¡ï¼Œä½†æ˜¯å¦‚ä½•å‘¢ï¼Ÿæœ‰æ—¶æˆ‘ä»¬éœ€è¦æå‡è¯¥çŠ¶æ€ä»¥å…±äº«å®ƒï¼Œæˆ–è€…å°†è¯¥ç»„ä»¶æ”¾åœ¨æ ‘ä¸­æ›´é«˜çš„ä½ç½®ä»¥ä¾¿åº”ç”¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†å¯ä»¥æ§åˆ¶å®ƒâ€¦â€¦å¯¹å—ï¼Ÿâ€¦â€¦ğŸ¤” è¿™äº›å¹´æ¥ï¼Œæˆ‘å¯¹æ‰˜ç®¡ä»¥åŠå¦‚ä½•æœ‰æ•ˆåœ°å°†è¿™ä¸€åŸåˆ™åº”ç”¨åˆ°æˆ‘æ„å»ºçš„ç»„ä»¶è¿›">
<meta property="og:locale">
<meta property="og:image" content="https://zzh-cat.oss-cn-beijing.aliyuncs.com/picture/871db387-c21e-40ce-a9db-4f2a38258a19.jpg">
<meta property="article:published_time" content="2023-03-18T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-18T16:00:00.000Z">
<meta property="article:author" content="grafield">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zzh-cat.oss-cn-beijing.aliyuncs.com/picture/871db387-c21e-40ce-a9db-4f2a38258a19.jpg">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/05/13/%E4%BA%86%E8%A7%A3%20useSyncExternalStore/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/03/11/React%20Ref%20Callback%EF%BC%9A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&text=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&is_video=false&description=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®&body=Check out this article: https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&name=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&t=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%98%AF%E6%89%98%E7%AE%A1%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">åˆ°åº•ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E4%B8%AD%E7%9A%84%E6%89%98%E7%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">React ä¸­çš„æ‰˜ç®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%8D%E6%9D%82%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">æ›´å¤æ‚çš„æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">4.</span> <span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5"><span class="toc-number">5.</span> <span class="toc-text">æ›´è¿›ä¸€æ­¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E6%88%90%E5%88%86"><span class="toc-number">6.</span> <span class="toc-text">ä¸å—æ§åˆ¶çš„å¤åˆæˆåˆ†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">7.</span> <span class="toc-text">ç»“è®º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">grafield</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-03-18T16:00:00.000Z" itemprop="datePublished">2023-03-19</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>å‡ºäºæ‰€æœ‰æœ€å¥½çš„æ„å›¾ï¼Œä»£ç åº“é€šå¸¸æœ€ç»ˆä¼šå˜æˆä¸€ä¸ªç”±ç»„ä»¶ã€æŠ½è±¡å’Œå…¨å±€çŠ¶æ€ï¼ˆç”±ç¬¬ä¸‰æ–¹åº“ç®¡ç†ï¼‰ç»„æˆçš„é”™ç»¼å¤æ‚çš„ç½‘ç»œï¼Œä½¿æœ€å°çš„æ›´æ”¹æˆä¸ºæ´»ç”Ÿç”Ÿçš„å™©æ¢¦ï¼Œè€Œç»´æŠ¤åˆ™æˆä¸ºä¸€ç§å¹³è¡¡è¡Œä¸ºã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°äººä»¬è°ˆè®ºé¿å…æŠ½è±¡ï¼Œä½†æ˜¯å¦‚ä½•å‘¢ï¼Ÿæœ‰æ—¶æˆ‘ä»¬éœ€è¦æå‡è¯¥çŠ¶æ€ä»¥å…±äº«å®ƒï¼Œæˆ–è€…å°†è¯¥ç»„ä»¶æ”¾åœ¨æ ‘ä¸­æ›´é«˜çš„ä½ç½®ä»¥ä¾¿åº”ç”¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†å¯ä»¥æ§åˆ¶å®ƒâ€¦â€¦å¯¹å—ï¼Ÿâ€¦â€¦ğŸ¤”</p>
<p>è¿™äº›å¹´æ¥ï¼Œæˆ‘å¯¹æ‰˜ç®¡ä»¥åŠå¦‚ä½•æœ‰æ•ˆåœ°å°†è¿™ä¸€åŸåˆ™åº”ç”¨åˆ°æˆ‘æ„å»ºçš„ç»„ä»¶è¿›è¡Œäº†å¾ˆå¤šæ€è€ƒã€‚æˆ‘å¼€å§‹æ³¨æ„åˆ°æˆ‘çš„å·¥ä½œä¸­å‡ºç°äº†ä¸€ç§æ¨¡å¼ï¼Œæˆ‘æƒ³åˆ†äº«å®ƒä»¥åŠå®ƒå¦‚ä½•å¸®åŠ©ç¼“è§£ä¸Šè¿°ç—›è‹¦ã€‚</p>
<p>ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£æ‰˜ç®¡æ„å‘³ç€ä»€ä¹ˆã€‚</p>
<h2 id="åˆ°åº•ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ"><a href="#åˆ°åº•ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ" class="headerlink" title="åˆ°åº•ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ"></a>åˆ°åº•ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ</h2><p>Kent C. Dodds æœ‰ä¸€ç¯‡å…³äºè¯¥ä¸»é¢˜çš„<a target="_blank" rel="noopener" href="https://kentcdodds.com/blog/colocation">ç²¾å½©æ–‡ç« </a>ï¼Œä»–ä»¥ä»£ç æ³¨é‡Šä¸ºä¾‹ã€‚ä»–è¯¦ç»†è¯´æ˜äº†å¦‚æœè§£é‡Šä¸€æ®µä»£ç çš„æ³¨é‡Šç›´æ¥ä½äºå®ƒæ‰€è§£é‡Šçš„ä»£ç ä¹‹ä¸Šï¼Œé‚£ä¹ˆç†è§£ä¸€æ®µä»£ç æ˜¯å¦‚ä½•å˜å¾—æ›´å®¹æ˜“çš„ã€‚ä»»ä½•å…¶ä»–åœ°æ–¹ï¼ˆä¾‹å¦‚å¦ä¸€ä¸ªæ–‡ä»¶ï¼‰éƒ½ä¼šä½¿ä»£ç æ›´éš¾ç†è§£ï¼Œå¹¶ä¸”æ›´æ”¹ä»£ç å¾ˆå®¹æ˜“ä½¿è¯¥æ³¨é‡Šå˜å¾—å¤šä½™è€Œæ²¡æœ‰äººæ„è¯†åˆ°ã€‚</p>
<p>ä»–å°†æ‰˜ç®¡æè¿°ä¸ºå°†ä»£ç æ”¾ç½®åœ¨å°½å¯èƒ½é è¿‘å®ƒå°½å¯èƒ½ç›¸å…³çš„åœ°æ–¹ã€‚</p>
<blockquote>
<p>ä¸€èµ·å˜åŒ–çš„äº‹ç‰©åº”è¯¥å°½å¯èƒ½é è¿‘ã€‚</p>
</blockquote>
<h2 id="React-ä¸­çš„æ‰˜ç®¡"><a href="#React-ä¸­çš„æ‰˜ç®¡" class="headerlink" title="React ä¸­çš„æ‰˜ç®¡"></a>React ä¸­çš„æ‰˜ç®¡</h2><p>æˆ‘æ„è¯†åˆ°æˆ‘çš„åŒé¾„äººå’Œæˆ‘æ­£åœ¨çŠ¯è§„çš„ä¸€ä»¶å¸¸è§äº‹æƒ…æ˜¯å¯¹ DRY çš„å¼ºçƒˆæ¸´æœ›ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>&lt;Dialog&gt;</code> ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›éœ€è¦ä»æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†æ‰“å¼€çš„å†…å®¹ï¼Œæˆ‘ä»¬è®¤ä¸ºâ€œå¥½å§ï¼Œæˆ‘ä¸æƒ³å°†ç›¸åŒçš„å†…å®¹æ”¾åœ¨å¤šä¸ªåœ°æ–¹ï¼Œé‚£ä¸æ˜¯ DRYâ€ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ <code>App</code> ï¼ˆæˆ–ç±»ä¼¼çš„ï¼‰ä¸­ï¼Œè¿æ¥ä¸€äº›å…¨å±€çŠ¶æ€å¹¶å…è®¸æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†æ›´æ”¹è¯¥çŠ¶æ€ã€‚æŠ½è±¡å¼€å§‹ã€‚</p>
<p>ç„¶åæˆ‘çªç„¶æƒ³åˆ°æˆ‘ä»¬ä¸€ç›´éƒ½çŸ¥é“çš„äº‹æƒ…ï¼Œä½†ç”±äºæŸç§åŸå› åœ¨å°†åº”ç”¨ç¨‹åºè¿æ¥åœ¨ä¸€èµ·æ—¶å¾€å¾€ä¼šå¿½ç•¥å®ƒã€‚ç»„ä»¶å¯é‡å¤ä½¿ç”¨ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬å°†æˆ‘ä»¬çš„å†…å®¹ä»æ§åˆ¶å®ƒçš„åœ°æ–¹ç§»å¼€å¹¶å¼•å…¥ä¸€å †å…¨å±€çŠ¶æ€æ¥é‡ç”¨æŸäº›ä¸œè¥¿ï¼Ÿ</p>
<p>å¦‚æœæˆ‘ä»¬é€šè¿‡å°† UI çš„é‡å¤ä½¿ç”¨éƒ¨åˆ†æ†ç»‘åˆ°å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å¤šä¸ªä½ç½®ä½¿ç”¨çš„ç»„ä»¶æ¥åº”ç”¨ DRYï¼Œè€Œä¸æ˜¯ä»å¤šä¸ªä½ç½®æ§åˆ¶ç»„ä»¶çš„å•ä¸ªå®ä¾‹ï¼Œä¼šæ€æ ·ï¼Ÿ</p>
<p>è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡å°è¯•ï¼š</p>
<iframe src="https://codesandbox.io/embed/avoid-global-state-colocate-demo-1-fv2uy?fontsize=14&hidenavigation=1&theme=dark" width="100%" height="500px" frameborder="0" loading="lazy" allowfullscreen></iframe>

<p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¯é‡ç”¨çš„ <code>Dialog</code> ç»„ä»¶ï¼Œå®ƒå°è£…äº†æ‰€æœ‰å¯¹è¯æ¡†åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­çš„å¤–è§‚å’Œè¡Œä¸ºæ–¹å¼ï¼Œä½†éšåæˆ‘ä¸ºæ‰€æœ‰éœ€è¦çš„åé¦ˆå†…å®¹ã€æ ·å¼å’Œé€»è¾‘åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„ <code>Feedback</code> ç»„ä»¶ä»å¤šä¸ªåœ°æ–¹æ‰“å¼€ã€‚å®ƒåœ¨å†…éƒ¨å‘ˆç° <code>Dialog</code>ã€‚</p>
<p>ä¸è¿‡ï¼Œæ‚¨åœ¨è¿™é‡Œä¼šæ³¨æ„åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ç”¨æˆ·å¯ä»¥åŒæ—¶æ‰“å¼€ <code>Dialog</code> çš„å¤šä¸ªå®ä¾‹ã€‚æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·ï¼Œå› ä¸ºæˆ‘ä»¬è¯•å›¾åšæŒå…±ç½®åŸåˆ™ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½æŠ½è±¡å‡ºä¸€äº›å…¨å±€çŠ¶æ€æ¥ç¡®ä¿ä¸€æ¬¡ä¸€ä¸ªã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•åœ¨æ²¡æœ‰å…¨å±€çŠ¶æ€æˆ–å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå¯é‡ç”¨å®ä¾‹çš„æƒ…å†µä¸‹å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®é™…éœ€è¦åšçš„æ˜¯åœ¨æœ‰äººå•å‡»å®ƒä¹‹å¤–çš„å†…å®¹æ—¶å…³é—­ <code>Dialog</code> ã€‚è®©æˆ‘ä»¬æŠŠå®ƒè¿æ¥èµ·æ¥ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Dialog</span> = (<span class="params">&#123; onClose, ...props &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> = event =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> dialog = ref.<span class="property">current</span>;</span><br><span class="line">      <span class="keyword">if</span> (!dialog?.<span class="title function_">contains</span>(event.<span class="property">target</span>)) &#123;</span><br><span class="line">        <span class="title function_">onClose</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick, &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick, &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codesandbox.io/s/avoid-global-state-colocate-demo-2-xtpgw">https://codesandbox.io/s/avoid-global-state-colocate-demo-2-xtpgw</a></p>
<p>æˆ‘å·²ç»å‘ <code>Dialog</code> ç»„ä»¶æ·»åŠ äº†ä¸€äº› <code>document</code> ä¾¦å¬å™¨ï¼Œå› æ­¤ï¼Œé€šè¿‡å°è¯•æƒ³å‡ºé¿å…å…¨å±€çŠ¶æ€çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å·²ç»è®¾æ³•æ»¡è¶³ç»„ä»¶ä¸€æ¬¡åªå…è®¸æ‰“å¼€ä¸€ä¸ªçš„è¦æ±‚ã€‚</p>
<h2 id="æ›´å¤æ‚çš„æ¨¡å¼"><a href="#æ›´å¤æ‚çš„æ¨¡å¼" class="headerlink" title="æ›´å¤æ‚çš„æ¨¡å¼"></a>æ›´å¤æ‚çš„æ¨¡å¼</h2><p>æˆ‘å¼€å§‹æƒ³çŸ¥é“æ˜¯å¦æœ‰æ›´å¤æ‚çš„é—®é¢˜å¯ä»¥ä»è¿™ç§æ–¹æ³•ä¸­å—ç›Šï¼Œå¹¶å‘ç°è‡ªå·±å¿…é¡»æ„å»ºä¸€äº›é€šå¸¸ç”¨å…¨å±€çŠ¶æ€è§£å†³çš„é—®é¢˜â€”â€”ä¾§è¾¹æ ä¸­çš„å±æ€§é¢æ¿ã€‚æ‚¨çŸ¥é“ï¼Œæ‚¨åœ¨ Sketch ç­‰äº§å“ä¸­çœ‹åˆ°çš„ UI ç±»å‹ã€‚</p>
<p><img src="https://zzh-cat.oss-cn-beijing.aliyuncs.com/picture/871db387-c21e-40ce-a9db-4f2a38258a19.jpg"></p>
<p>åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼Œé‚£äº›ä¾§é¢æ¿ä¸€ç›´æ˜¯æˆ‘ç”Ÿæ´»ä¸­çš„ç¥¸æ ¹ã€‚æˆ‘ä»¬åœ¨ <code>Main</code> ä¸­æ¸²æŸ“æŸäº›ä¸œè¥¿ï¼Œåœ¨ <code>Sidebar</code> ä¸­æ¸²æŸ“å±æ€§ï¼Œç„¶åç»§ç»­å¼•å…¥ä¸€å † <code>switch</code> å­å¥ï¼Œæ ¹æ®æˆ‘ä»¬çš„å…¨å±€çŠ¶æ€å‘Šè¯‰æˆ‘ä»¬åœ¨å±å¹•ä¸Šé€‰æ‹©çš„å†…å®¹æ¥ç¡®å®šè¦æ˜¾ç¤ºçš„å±æ€§ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡å…¨å±€çŠ¶æ€æˆ–é“å…·é’»æ¢æ¥ä¼ è¾¾å±æ€§é€‰æ‹©ï¼Œä»¥æ”¹å˜å±å¹•ä¸Šäº‹ç‰©çš„å¤–è§‚ã€‚</p>
<p>å®ƒä¹Ÿæ˜¯ä»£ç å½¢å¼çš„ä¸€ç§ï¼Œå¹¶ä¸”è¿™äº›é€»è¾‘éƒ½ä¸ä¼šè¢«æ‘‡æ ‘ã€‚å¦‚æœæœ‰äººä»ä¸æ¸²æŸ“ <code>Rectangle</code> æ€ä¹ˆåŠï¼Ÿæ— è®ºå¦‚ä½•ï¼Œè¯¥é€»è¾‘å°†åˆ†å¸ƒåœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä»¥å¤„ç†çŸ©å½¢ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘æƒ³çŸ¥é“å¦‚ä½•å°†æ‰˜ç®¡åº”ç”¨åˆ°åƒè¿™æ ·å¤æ‚çš„ä¸œè¥¿ä¸Šï¼Œæˆ‘é€šè¿‡åº”ç”¨ä¸ <code>Dialog</code> ç›¸åŒçš„æ€ç»´æ¥å¼„æ¸…æ¥šäº†ã€‚</p>
<p>å½“æˆ‘åªæƒ³é‡ç”¨ä¸æˆ‘çš„çŸ©å½¢ç›¸å…³çš„å†…å®¹æ—¶ï¼Œä¸ºä»€ä¹ˆæˆ‘è¦å°è¯•é‡ç”¨å•ä¸ª <code>PropertiesPanel</code> å®ä¾‹ï¼Œè¿™æ„å‘³ç€å®ƒå®é™…ä¸Šåªæ˜¯æˆ‘æƒ³é‡ç”¨çš„ä½ç½®ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œç¬¬ä¸€ä¸ªè¦æ±‚æ˜¯é€šè¿‡ä¸ºçŸ©å½¢å¯ä»¥é‡å¤ä½¿ç”¨çš„æ¯ä¸ªå±æ€§é¢æ¿éƒ¨åˆ†åˆ›å»ºç»„ä»¶æ¥è§£å†³çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘å°†è¯¥ä»£ç ä¸ <code>Rectangle</code> ç»„ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œå®ƒå°±ä¸ä¼šåœ¨è¾¹æ ã€‚</p>
<p>æˆ–è€…å®ƒä¼šâ€¦åšæŒä¸‹å»ï¼Œæ— è®ºæˆ‘å•å‡»å“ªä¸ªæŒ‰é’®ï¼Œ <code>Dialog</code> éƒ½ä¼šåœ¨å±å¹•ä¸­é—´æ‰“å¼€ã€‚é—¨æˆ·ç½‘ç«™ï¼å¦‚æœæˆ‘ä»¬ä¸ºå±æ€§é¢æ¿å¯ä»¥è¿›å…¥çš„ä¾§è¾¹æ åˆ›å»ºä¸€ä¸ªç©ºç™½ç©ºé—´ï¼Œåˆ™æ‰˜ç®¡æ˜¯åŒæ­¥çš„ã€‚</p>
<p>è®©æˆ‘ä»¬å°† <code>Rectangle</code> æ„å»ºä¸ºå¤åˆç»„ä»¶ã€‚è¿™å…è®¸ä¸åŒçš„åº”ç”¨ç¨‹åºåœ¨å…¶åº”ç”¨ç¨‹åºéœ€è¦çš„ä»»ä½•åœ°æ–¹è®¿é—®å±æ€§é¢æ¿ï¼Œå› ä¸ºå®ƒå°†ä½œä¸ºå•ç‹¬çš„éƒ¨åˆ†å…¬å¼€ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Styler</span>,</span><br><span class="line">  <span class="title class_">StylerSize</span>,</span><br><span class="line">  <span class="title class_">StylerBackgroundColor</span>,</span><br><span class="line">  <span class="title class_">StylerBorder</span>,</span><br><span class="line">  <span class="comment">// StylerTextShadow - not necessary in Rectangle so will be tree-shaken</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./Styler&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RectangleContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Rectangle</span> = (<span class="params">&#123; children &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [style, setStyle] = <span class="title class_">React</span>.<span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [selected, setSelected] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// click outside logic to set `selected` to `false`</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">RectangleContext.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;React.useMemo(</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        () =&gt;</span> (&#123; selected, style, onStyleChange: setStyle &#125;),</span></span><br><span class="line"><span class="language-xml">        [style, selected],</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setSelected(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">RectangleContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">RectangleStyler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title class_">React</span>.<span class="title function_">useContext</span>(<span class="title class_">RectangleContext</span>);</span><br><span class="line">  <span class="keyword">return</span> context.<span class="property">selected</span> ? (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Styler</span> <span class="attr">style</span>=<span class="string">&#123;context.style&#125;</span> <span class="attr">onStyleChange</span>=<span class="string">&#123;context.onStyleChange&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StylerSize</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StylerBackgroundColor</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StylerBorder</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Styler</span>&gt;</span></span></span><br><span class="line">  ) : <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>Rectangle</code> ä½¿ç”¨è‡ªå®šä¹‰æ„å»ºçš„ <code>Styler</code> ç»„ä»¶ï¼Œè¯¥ç»„ä»¶æ ¹æ®åœ¨å…¶ä¸­å‘ˆç°çš„å±æ€§è¿”å›æ ·å¼å¯¹è±¡ã€‚å½“è¿™äº›å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬æ›´æ–°çŸ©å½¢ä¸Šçš„ <code>style</code> å±æ€§ã€‚</p>
<p>åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ Sketch å…‹éš†ä¸­ä½¿ç”¨å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>SidebarPortal</code> ç»„ä»¶æ¥åŒ…è£…æˆ‘ä»¬çš„ <code>RectangleStyler</code> å¹¶å°†å…¶å‘ˆç°åœ¨ä¾§è¾¹æ ä¸­ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">SidebarContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>([]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">SidebarProvider</span> = props =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> sidebarState = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SidebarContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;sidebarState&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Sidebar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [, setSidebar] = <span class="title class_">React</span>.<span class="title function_">useContext</span>(<span class="title class_">SidebarContext</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;setSidebar&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">SidebarPortal</span> = (<span class="params">&#123; children &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [sidebar] = <span class="title class_">React</span>.<span class="title function_">useContext</span>(<span class="title class_">SidebarContext</span>);</span><br><span class="line">  <span class="keyword">return</span> sidebar ? <span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(children, sidebar) : <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æŠŠå®ƒå…¨éƒ¨æ¶ˆè€—æ‰ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Main</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Rectangle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SidebarPortal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">RectangleStyler</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">SidebarPortal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Rectangle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">SidebarProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Main</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Sidebar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">SidebarProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å•å‡» <code>Rectangle</code> åœ¨è¾¹æ ä¸­æ‰“å¼€å…¶å±æ€§ã€‚å¯æ˜¯ç­‰ç­‰ã€‚å½“æˆ‘ä»¬ä¸ä¾§è¾¹æ ä¸­çš„æ ·å¼å™¨äº¤äº’æ—¶ï¼Œå®ƒä¼šå…³é—­ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œå…¨éƒ¨å°è¯•ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºå•å‡»å¤–éƒ¨é€»è¾‘ã€‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ <code>rectangle.contains</code> æ¥æ£€æŸ¥è¢«ç‚¹å‡»çš„å…ƒç´ æ˜¯å¦åœ¨çŸ©å½¢ä¹‹å¤–ä»¥åŠæ ·å¼å™¨æ˜¯å¦åœ¨çŸ©å½¢ä¹‹å¤–ã€‚å®ƒåœ¨ä¾§è¾¹æ ä¸­ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒReact æœ‰ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„åŠŸèƒ½ï¼Œå®ƒå¾ˆå°‘å—åˆ°ç§°èµï¼Œä½†åœ¨åƒè¿™æ ·è¿›è¡Œæ‰˜ç®¡æ—¶éå¸¸æœ‰ç”¨ã€‚ React äº‹ä»¶åœ¨ React æ ‘ä¸­å†’æ³¡ï¼Œæ— è®ºå®ƒä»¬åœ¨ DOM ä¸­çš„ä½•å¤„å‘ˆç°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥é˜²æ­¢ä¾§è¾¹æ ä¸­çš„ç‚¹å‡»å…³é—­æ ·å¼å™¨ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Rectangle</span> = (<span class="params">&#123; children &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">const</span> [style, setStyle] = <span class="title class_">React</span>.<span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [selected, setSelected] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> isClickInsideRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isClickInsideRef.<span class="property">current</span>) <span class="title function_">setSelected</span>(<span class="literal">false</span>);</span><br><span class="line">      isClickInsideRef.<span class="property">current</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">RectangleContext.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;React.useMemo(</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        () =&gt;</span> (&#123; selected, style, onStyleChange: setStyle &#125;),</span></span><br><span class="line"><span class="language-xml">        [style, selected],</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;style&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setSelected(true)&#125;</span></span><br><span class="line"><span class="language-xml">        onClickCapture=&#123;() =&gt; (isClickInsideRef.current = true)&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">RectangleContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡ React å•å‡»äº‹ä»¶è®¾ç½®äº†ä¸€ä¸ª <code>isClickInside</code> å¸ƒå°”å€¼ã€‚å¦‚æœç‚¹å‡»åœ¨ <code>RectangleStyler</code> ä¸­ï¼Œè¿™å°†æ˜¯ <code>true</code> å› ä¸ºå®ƒå°†æ˜¯ React Tree ä¸­çš„ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒçš„ç‚¹å‡»å°†ä¼ æ’­åˆ° <code>Rectangle</code> ã€‚</p>
<iframe src="https://codesandbox.io/embed/avoid-global-state-colocate-demo-4-ohm7d?fontsize=14&hidenavigation=1&theme=dark" width="100%" height="500px" frameborder="0" loading="lazy" allowfullscreen></iframe>

<p>è¿™ç§æ–¹æ³•å°†å‡å°‘ä»£ç åº“ä¸­çš„ä¸€ç³»åˆ—å¤æ‚æ€§ã€‚ <code>PropertiesPanel</code> å®ä¾‹ä¸­ä¸å†æœ‰ <code>switch</code> è¯­å¥ã€‚ä¸å†æœ‰å°†æ ·å¼é€‰æ‹©è¿æ¥åˆ°çŸ©å½¢çš„å…¨å±€çŠ¶æ€ã€‚å¦‚æœä½¿ç”¨ <code>React.lazy</code> æœ‰æ¡ä»¶åœ°æ¸²æŸ“ <code>Rectangle</code> ï¼Œä¸€åˆ‡éƒ½å°†è¢«æ‘‡æ ‘ã€‚å®ƒè¿˜é¿å…äº†åœ¨å…¶ä»–ç»„ä»¶ä¸­ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“â€”â€”å¦‚æœæ‚¨æ­£åœ¨æ›´æ”¹ <code>RectangleStyler</code> ï¼Œåˆ™åªä¼šé‡æ–°æ¸²æŸ“çŸ©å½¢éƒ¨åˆ†ã€‚</p>
<h2 id="æ›´è¿›ä¸€æ­¥"><a href="#æ›´è¿›ä¸€æ­¥" class="headerlink" title="æ›´è¿›ä¸€æ­¥"></a>æ›´è¿›ä¸€æ­¥</h2><p>æˆ‘ä»¬ç›®å‰ä¸€ç›´åœ¨æ¸²æŸ“è¿™ä¸ªçŸ©å½¢ï¼Œä½†åœ¨ç±»ä¼¼ Sketch çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™é€šå¸¸ä¼šé€šè¿‡â€œæ·»åŠ çŸ©å½¢â€æŒ‰é’®æ·»åŠ ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŸç§çŠ¶æ€å°†è¯¥é€»è¾‘æ·»åŠ åˆ°æˆ‘ä»¬çš„ <code>App</code> ä¸­ï¼Œè¯¥çŠ¶æ€å†³å®š <code>Rectangle</code> æ˜¯å¦åº”è¯¥å‘ˆç°ï¼Œä½†è¿™æ„å‘³ç€è¯¥é€»è¾‘æœ€ç»ˆå¯èƒ½ä¼šä¸è¯¥ç»„ä»¶å®Œå…¨æ–­å¼€è¿æ¥ï¼Œæˆ‘ä»¬å°†å†æ¬¡å¤±å»æ‰˜ç®¡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† <code>Trigger</code> å°è£…ä¸º <code>Rectangle</code> ç»„ä»¶çš„ä¸€éƒ¨åˆ†æ¥åšæ›´å¤šçš„äº‹æƒ…ï¼Œå¹¶åœ¨å•å‡»æ—¶é‡æ–°ä½¿ç”¨é—¨æˆ·æŠ€æœ¯åœ¨ <code>Main</code> ä¸­å‘ˆç° <code>Rectangle</code> ã€‚</p>
<iframe src="https://codesandbox.io/embed/avoid-global-state-colocate-demo-5-xylij?fontsize=14&hidenavigation=1&theme=dark" width="100%" height="500px" frameborder="0" loading="lazy" allowfullscreen></iframe>

<h2 id="ä¸å—æ§åˆ¶çš„å¤åˆæˆåˆ†"><a href="#ä¸å—æ§åˆ¶çš„å¤åˆæˆåˆ†" class="headerlink" title="ä¸å—æ§åˆ¶çš„å¤åˆæˆåˆ†"></a>ä¸å—æ§åˆ¶çš„å¤åˆæˆåˆ†</h2><p>æˆ‘å·²ç»å¼€å§‹å°† React ä¸­çš„è¿™ç§æ‰˜ç®¡æŠ€æœ¯ç§°ä¸ºä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶æ¨¡å¼ã€‚è¿™äº›ç»„ä»¶å¯ä»¥å®Œæˆä¸å…¶å…³æ³¨ç›¸å…³çš„æ‰€æœ‰äº‹æƒ…ï¼Œè€Œæ— éœ€æ‚¨æ‰‹åŠ¨è¿æ¥å®ƒä»¬æ¥ä½¿ç”¨å®ƒä»¬ã€‚æ²¡æœ‰çŠ¶æ€ï¼Œæ²¡æœ‰å‚è€ƒã€‚ä¸€åˆ‡æ­£å¸¸â„¢ã€‚</p>
<p>æˆ‘ä»¬åœ¨ <a target="_blank" rel="noopener" href="https://www.modulz.app/">Modulz</a> çš„ <a target="_blank" rel="noopener" href="https://www.radix-ui.com/docs/primitives/overview/introduction">Radix Primitives</a> å›¢é˜Ÿä¸­é‡‡ç”¨äº†è¿™ç§æ–¹æ³•æ¥å°è£…å¸¸è§ Web ç»„ä»¶çš„å¯è®¿é—®æ€§å’ŒåŠŸèƒ½è¦æ±‚ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œã€‚</p>
<p>ä¸‹é¢æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„ <code>Dialog</code> ä½œä¸º <code>Feedback</code> ç»„ä»¶æ¥åº”ç”¨å…±ç½®åŸåˆ™ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Dialog</span> <span class="keyword">from</span> <span class="string">&#x27;@radix-ui/react-dialog&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Feedback</span> = (<span class="params">&#123; children, ...props &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Dialog.Root</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Dialog.Trigger</span> <span class="attr">asChild</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">Dialog.Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Dialog.Content</span> &#123;<span class="attr">...props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Thoughts?<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">textarea</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>Submit feedback<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Dialog.Close</span>&gt;</span>Close<span class="tag">&lt;/<span class="name">Dialog.Close</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Dialog.Content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Dialog.Root</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// render (</span></span><br><span class="line"><span class="comment">// 	&lt;Feedback&gt;</span></span><br><span class="line"><span class="comment">//		&lt;PrimaryButton&gt;Feedback&lt;/PrimaryButton&gt;</span></span><br><span class="line"><span class="comment">//	&lt;/Feedback&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ...</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 	&lt;Feedback&gt;</span></span><br><span class="line"><span class="comment">//		&lt;SecondaryButton&gt;Feedback&lt;/SecondaryButton&gt;</span></span><br><span class="line"><span class="comment">//	&lt;/Feedback&gt;</span></span><br><span class="line"><span class="comment">// )</span></span><br></pre></td></tr></table></figure>

<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ‰˜ç®¡å¯ä»¥æ˜¾ç€é™ä½å¤æ‚æ€§ã€‚æˆ‘çœŸçš„å¸Œæœ›è¿™èƒ½å¯å‘æ‚¨é€šè¿‡æ”¯æŒç»„ä»¶é‡ç”¨è€Œä¸æ˜¯å®ä¾‹é‡ç”¨åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­åº”ç”¨è¯¥åŸåˆ™ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://jjenzz.com/avoid-global-state-colocate">Avoid Global State â€” Co-locate with Uncontrolled Compound Components</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%98%AF%E6%89%98%E7%AE%A1%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">åˆ°åº•ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E4%B8%AD%E7%9A%84%E6%89%98%E7%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">React ä¸­çš„æ‰˜ç®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%8D%E6%9D%82%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">æ›´å¤æ‚çš„æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">4.</span> <span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5"><span class="toc-number">5.</span> <span class="toc-text">æ›´è¿›ä¸€æ­¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E6%88%90%E5%88%86"><span class="toc-number">6.</span> <span class="toc-text">ä¸å—æ§åˆ¶çš„å¤åˆæˆåˆ†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">7.</span> <span class="toc-text">ç»“è®º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&text=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&is_video=false&description=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®&body=Check out this article: https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&title=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&name=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://yaesakuras.github.io/2023/03/18/%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E2%80%94%E2%80%94%E4%B8%8E%E4%B8%8D%E5%8F%97%E6%8E%A7%E5%88%B6%E7%9A%84%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E5%85%B1%E7%BD%AE/&t=é¿å…å…¨å±€çŠ¶æ€â€”â€”ä¸ä¸å—æ§åˆ¶çš„å¤åˆç»„ä»¶å…±ç½®"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    grafield
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
